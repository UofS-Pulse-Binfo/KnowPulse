
Tripal 3 Roadmap
=================

- The upgrade from Tripal2 to Tripal 3 requires a complete re-write of all our content pages. This is necessitated by the switch from templates to fields.
- We are using this upgrade process to redesign, refresh and rethink the current content pages on KnowPulse to ensure they are the most helpful they can be 
- This document will show a breakdown of all planned Tripal Content Types for KnowPulse in Tripal3, as well as, include detailed plans for field development in each type.
- The following plans will not all be implemented in the first release of KnowPulse on Tripal3 but instead represent the complete picture of our current plans
- Please note that the move from Tripal2 to Tripal3 represents a switch from chado-based content types to ontology-based content types. As such one content type in Tripal2 will become multiple specialized content types in Tripal3.

KnowPulse Content Types
========================

- chado.organism table (seperated using organismprop)
  - Crop
  - Wild Species
  - Related Species
- chado.project table (seperated using projectprop)
  - Research Project (semantic science ontology; study; SIO:001066)
  - Research Experiment (semantic science ontology; experiment; SIO:000994)
  - Genome Assembly (Sequence Ontology; genome)
- chado.publication (full table)
  - Publication (TPUB; Publication)
- chado.feature table (seperated using feature.type_id)
  - Chromosome (Sequence Ontology; pseudomolecule)
  - Contig (Sequence Ontology; contig)
  - Variant (Sequence Ontology; sequence_variant)
  - Genetic Marker  (Sequence Ontology; genetic_marker)
  - QTL (Sequence Ontology; QTL)
- chado.stock (seperated using stock.type_id)
  - Germplasm Accession (Crop ontology; accession; CO_010:0000044)
  - Breeding Cross (Crop ontology; generated germplasm(CO_010:0000255)?; breeder's line(CO_010:0000093)?, breeding material(CO_010:0000159)?)
  - Registered Varieties (Sequence Ontology; cultivar; CO_010:0000029)
  - Recombinant Imbred Line (Crop Ontology; inbred line; CO_010:0000162)
- chado.cvterm (specific cv_id)
  - Phenotypic Trait (Trait Ontology; plant trait)
- chado.featuremap (full table) 
  - Genetic Map (data onotology; Map)
  
ADD STOCK COLLECTIONS (i.e. diversity panels)

General
-------

Species (Organism)
^^^^^^^^^^^^^^^^^^^

The organism content type will include each of our crops and wild relatives. Stored in the Chado Organism table. Design-wise we are thinking of these as launch pads which both summarize the data per crop and link to pre-filtered searches.

Genome Pane
............

- Current Assembly: This field should provide information on the most recent genome assembly or assemblies for this species.
- Genome Browser: This field should summarize the data in the current JBrowse and have an image linking to the JBrowse instance for the current assembly
- Whole-Genome Diagram: This field should show an embedded CViTjs diagram summarizing the current assembly’s annotation and markers.
- Past Assemblies: This field should list the past assemblies with links to archived information.

Genetic Markers Pane
....................

- Types: This field summarizes the types of markers available for this organism.
- Quick Search: This field provides a simple keyword search with limited advanced search collapsed. When the user clicks search, they are redirected to the marker search page with their results pre-filtered.

Genetic Maps & QTL Pane
.......................

- Tiled display of available maps with each tile containing map metadata such as population, date generated, number of markers, QTL list
- QTL Quick Search: simple keyword search for QTLs.

Germplasm Pane
...............

- Types: This field summarizes the types of germplasm available for this organism. Should this be subject to permissions?
- Quick Search: This field provides a simple keyword search. No need for advanced search or breakdown by type.
- Recent UofS Varieties: a list of the most recent varieties.
- Variety Spotlight: Highlight a single variety
- RIL Populations: This could be a cool search that lets them select things like interspecific, species, phenotype of interest. Essentially allow people to search for a RIL without knowing it’s number 
- Germplasm Diversity: Show a map with each of our germplasm indicated.
- Wild Relatives: summarize the gene pools and/or phylogeny

Phenotypes
...........

- Quick Search: This field provides a simple keyword search. No need for advanced search? It would be helpful this field searched both names and linked cvterms.
- Phenotype Projects: Highlight our biggest and/or most recent phenotyping projects. Should show metadata for each such as population phenotyped, purpose, siteyears w/ data, funders logos if applicable. Links to project pages.

Research Project
^^^^^^^^^^^^^^^^^

Currently just a regular old project page. Stored in the Chado Project table. Need a way to break out? What about datasets which are currently projects with data? These pages should include all metadata about the project and summarize all the data generated by it.

### Overview Pane
- Project meta-data (stored as project properties)
- Abstract
### Genomic Data
- Barchart or infographic summarizing the types and amount of genomic data (sequence, genes, etc.) generated as part of this project.
### Genotypic Data
- Barchart or infographic summarizing the types and amount of genotypic data (markers, variants, germplasm assayed, genotype calls, etc.) for this project.
- Genotypes Search: Redirects to the genotype matrix pre-filtered for the current project. Provides form elements to further restrict the matrix.
### Phenotype Data
- Barchart or infographic summarizing the siteyears, traits and germplasm phenotyped for this project.
### Germplasm
- List the germplasm associated with this project with download. It might be a long list so make it searchable. Also, we should support stock collections which would then be listed at the top. For example, AGILE is using the Lentil Diversity Panel so it would be nice to say that at the top so users know it's not a random list ;-).
- We also need a way to add germplasm to a project through the form so keep in mind this one will need a form element.

Publication
^^^^^^^^^^^^
Stored in the Chado Publication table.

### Genome Assembly
Not sure where to store this information yet… Perhaps a type of project but the project table doesn’t have a type_id. Perhaps an analysis but then there will be a bunch of useless fields?

Genomic
-------

The following Tripal Content types refer to Genomic Content. All of the following content types are stored in the Chado Feature table. The specific records per type are indicated via the feature.type_id column.

Chromosome/Contig
^^^^^^^^^^^^^^^^^

The following described any page for a backbone sequence. Stored in the Chado Feature table broken out by type_id. These are currently unhelpful feature pages and new functionality to make them more useful is needed. That said, these pages likely won’t get used directly very often.

Variant
^^^^^^^^

The variant page is currently a customized feature page. Stored in the Chado Feature table broken out by type_id.

Genetic Marker
^^^^^^^^^^^^^^

The genetic marker page is currently a customized feature page. Stored in the Chado Feature table broken out by type_id.

Germplasm
----------

The following Tripal Content types refer to Germplasm Content. All of the following content types are stored in the Chado Stock table. The specific records per type are indicated via the stock.type_id column.

Germplasm Accession
^^^^^^^^^^^^^^^^^^^^

These are currently customized stock pages managed by the Tripal Germplasm module. Stored in the Chado Stock table broken out by type_id.

### Overview
- Basic information such as name, accession, what-not. This will remain a default Tripal pane  
- It would be great to finally have the breeder short-hand for the pedigree! This could be a separate field from the pedigree diagram so I can put it in the overview.

### Pedigree
- Shows the parentage pedigree diagram with all but the first 3 levels collapsed.
- All diagrams should now include a figure legend.
### Genotypes Pane
- Types: This field summarizes the number of markers per type with calls for the current germplasm.
- Genotypes Search: Redirects to the genotype matrix pre-filtered for the current germplasm. Provides form elements to further restrict the matrix.
### Breeding Markers
- List the calls for a set of CORE breeding markers. Make the set configurable at the field level.
### Phenotypes Pane
- List the value for a set of CORE phenotypes (e.g. seed coat, cotyledon color). Make the set configurable at the field level. Should it be entereable on the form? How do we handle multiple experiments, siteyears for a single trait/variety combo.

Cultivated Variety
^^^^^^^^^^^^^^^^^^^

These are currently customized stock pages managed by the Tripal Germplasm module. Stored in the Chado Stock table broken out by type_id. See https://www.crop-diversity.org/mgis/accession/01BEL084245 
### SAME AS ACCESSION
- Overview will indicate specific variety information and include the abstract and link to the registration publication if known.
- Phenotype pane should highlight phenotypes specifically of interest for this cultivar.

Breeding Cross
^^^^^^^^^^^^^^^

These are currently customized stock pages managed by the Tripal Germplasm module. Stored in the Chado Stock table broken out by type_id.

### SAME AS ACCESSION
- Overview will include information about the crossing block
- Is there enough information for a Crossing Block Pane? We would have year, season, number of crosses made…

Recombinant Imbred Line
^^^^^^^^^^^^^^^^^^^^^^^^

These are currently customized stock pages managed by the Tripal Germplasm module. Stored in the Chado Stock table broken out by type_id.
### SAME AS ACCESSION
- This Content Type will include all the panes that the Accession Content Type does.
- Overview should include specifics about the RIL including parents, latest generation, status and number of individuals.
- Phenotype pane should highlight phenotypes specifically of interest for this RIL.
### RIL Development Pane
- Reiterate the type of cross (Interspecific, intraspecific) 
- Indicates the parents of the RIL including their species.
- Development timeline including which years & how many individuals
- If the RIL is complete, indicate that and the final number of individuals.
### RIL Genotypes Pane
- Links to the VCF Filter form for the current RIL to facillitate downloading of the data.
- Field Provided by VCF Filter.

KnowPulse Field Types
======================

The following section described common field types. 
## Quick Search (Should be in Core?)
- This field type allows a user to search for additional content quickly and easily.
- It consists of a single keyword search box and optional, configurable advanced search form.
- Configuration:
  - Search URL this field redirects to
  - what key to use in the query string for entered keywords
  - Drupal Form API definition of advanced search elements where the keys of the elements are used in the query string
  - Description and/or help text to display to the user
  - Quick Search Title

## Summary Field (Should be in Core?)
- This field displays a graphical summary based on a materialized view.
- Configuration:
  - Select the Materialized View to get the summary from
  - Select which mview column maps to the legend (e.g. type name)
  - Optional filter by field: select field and mview column mapping
  - Select chart type: Pie, bar, etc.
  - Figure Title
  - Figure Description
  - Chart type specific configuration

## Embedded JBrowse by organism
- Embeds a JBrowse instance 
- Provided by the JBrowse integration module
- Contains linkout to full JBrowse page for more intensive browsing
- Configuration:
  - Select Organism Field for the current content type
  - Show/Hide Menubar, search, track selector
  - For each organism: select jbrowse, tracks, and location to show

## Whole-Genome View by organism
- Embeds a CViTjs diagram 
- Provided by the CViTjs integration module
- Contains linkout to full diagram
- Configuration:
  - Select Organism Field for the current content type
  - Show/Hide Controls, track selector
  - For each organism: select diagram and tracks to show

# Miscellaneous Notes
- We need an assembly page. Should this be an analysis or a project?
- We need to consider whether the individuals in a RIL need a page.


